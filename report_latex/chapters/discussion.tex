%----------------------------------------------------------------------------------------
% Discussion
%----------------------------------------------------------------------------------------
\section{Discussion}
\label{sec:discussion}

\subsection{Evaluation}
\label{sec:evaluation}

We have successfully implemented and integrated three key features into the Energy Gateway. These features include WiFi provisioning through Bluetooth, OTA updates, and UART communication.

Our WiFi provisioning through Bluetooth feature allows for streamlined configuration of WiFi credentials on ESP32 devices using a BLE-enabled device, such as a smartphone. This feature provides a more efficient and secure method of communication between devices in the realm of IoT, making it a valuable addition to the Energy Gateway system.

The OTA update feature enables remote firmware updates of the ESP32 board via a Wi-Fi connection, eliminating the need for a physical connection. This feature allows for the easy deployment of updates to the Energy Gateway system, even when it is deployed in hard-to-reach locations. We have also implemented a versioning system based on git tags to ensure that only new firmware images are updated and avoid updating the firmware to an older version.

Our UART communication feature allows the Energy Gateway system to poll and send data to serial devices. We have successfully established a UART connection between the ESP32 microcontroller and a Heltec Wireless Stick, which simulates the behavior of a serial device. We have also tested the system's performance under stress conditions, which helps ensure that the feature functions reliably in the final Energy Gateway product.

In terms of the results, our work has shown that the features have been successfully implemented and tested. The WiFi provisioning through Bluetooth feature simplifies the process of configuring WiFi credentials on ESP32 devices and enhances security by using BLE-enabled devices. The OTA update feature eliminates the need for a physical connection and allows for easy deployment of updates to the Energy Gateway system, while the UART communication feature provides the capability to poll and send data to serial devices.

Overall, our work on the Energy Gateway system has resulted in a more efficient and capable product that can effectively monitor and control energy consumption in a building. The features implemented have the potential to enhance the usability and security of the system and enable easy deployment of updates, which is critical in the realm of IoT. We have also demonstrated our ability to program with the ESP-IDF framework and utilize the FreeRTOS real-time operating system effectively.

\subsection{Explanation}
\label{sec:explanation}

Our work on implementing three key features into the Energy Gateway has shown successful results. The WiFi provisioning through Bluetooth feature, which enables streamlined configuration of WiFi credentials on ESP32 devices, is a valuable addition to the Energy Gateway system.

The OTA update feature, which enables remote firmware updates of the ESP32 board via a Wi-Fi connection, eliminates the need for a physical connection and simplifies the process of updating the system. Previous research has shown that OTA updates are critical for ensuring the security and reliability of IoT systems, as they allow for easy deployment of updates and patches to address vulnerabilities \cite{Villegas:2019}. Our implementation of OTA updates in the Energy Gateway system is an important step towards ensuring the security and reliability of the system.

The UART communication feature, which enables the Energy Gateway system to poll and send data to serial devices, is another important addition to the system. 

\subsection{Limitations and possible sources of errors}
\label{sec:limitations}

While conducting our experiments, we conducted stress tests only for the UART communication feature, and limited testing was done on the WiFi provisioning through Bluetooth feature and the OTA update feature. Further investigation is necessary under different environmental and usage conditions, to provide a comprehensive evaluation of the performance of these features and uncover any possible sources of error.

Our current implementation of the versioning system, based on git tags, was limited to ensuring that the firmware is not updated to the same version. Future studies could look into creating a more sophisticated versioning system capable of handling more complex scenarios. One approach could be to create a versioning system that ensures that the device never reverts to an older version of the firmware.

An additional enhancement that could be made to the OTA update feature is the implementation of a rollback mechanism that permits the device to revert to the previous version of the firmware in the event of an update failure. This would ensure that the device always runs a stable version of the firmware. The older version of the firmware is already stored on the device, but we were unable to implement the rollback mechanism due to time constraints.

The replacement of the device's entire binary each time a component is updated is a potential source of error, as the new binary could become corrupt. To minimize the possibility of the device being left inoperable, each component update could override only its own component binary, thereby necessitating that the device only update the binary of that component. We have yet to conduct an in-depth analysis of this approach's feasibility, but it is a topic that could be researched further in the future.

In conclusion, although our project has successfully developed and validated key features for the Energy Gateway system, certain limitations and potential sources of error must be considered. More comprehensive testing and improvements are required to increase the reliability and performance of these features.